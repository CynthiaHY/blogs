---
layout: post
title: "Managing Open Liberty and MicroProfile configuration files deployment into multiple Kubernetes environments"
categories: blog
author_picture: https://avatars3.githubusercontent.com/shamjithantholi
author_github: https://github.com/shamjithantholi
seo-title: Managing Open Liberty and MicroProfile configuration files deployment into multiple Kubernetes environments
seo-description: Methods to manage Open Liberty and MicroProfile configuration files in multiple Kubernetes environments.
blog_description: Methods to manage Open Liberty and MicroProfile configuration files in multiple Kubernetes environments.
open-graph-image: https://openliberty.io/img/blog/liberty-devops-generic-architecture.png
---
= Managing Open Liberty and MicroProfile configuration files deployment into multiple Kubernetes environments
Shamjith Antholi <https://github.com/shamjithantholi>
:imagesdir: /
:url-prefix:
:url-about: /

[#Intro]

== MicroProfile, Open Liberty configuration files and Kubernetes

link:https://microprofile.io[MicroProfile] and link:https://openliberty.io/[Open Liberty] applications uses the following configuration files, externalization of these files are a common coding practice.

            server.xml
            Environment variables
            microprofile-config.properties
            CustomConfig properties (implemented using org.eclipse.microprofile.config.spi.ConfigSource)

link:https://kubernetes.io[Kubernetes] is a popular container orchastration tool. Kubernetes basic operation unit called Pod works on isolation concept (every pod act as an independent VM unit), In this blog we will discuss about the next level of kubernetes isolation, which is the isolation of deployment environments (DEV,QA,PROD etc) on kubernetes cluster and how we can manage the deployment of MicroProfile and OpenLiberty configuration files on those environments. 


The link:https://microprofile.io[MicroProfile] specification consists of a collection of Enterprise Java APIs and technologies that together form a core baseline for microservices that aims to deliver application portability across multiple runtimes.

link:https://openliberty.io/[Open Liberty] is a lightweight open source Javaâ„¢ runtime that is built by using modular features. 

== Managing configurations sources through different Kubernetes environments

Applications deployed on multiple environments like DEV, QA and PROD will have environment specific configuration files. These environment specific configurations will have to be managed by associates whose access would be limited to specific environments. I will explain a simple way to manage environment specific files storage, packaging and deploying across different environments.

=== 1. DEV enviornment 

On DEV environment, all the common config files and DEV specific config files will be stored on Git on a separate branches (not along with the source code repository, a separate repository can be created for configs - in this way, we can stop exposing the source code to non-DEV team).  

On Build tool (like jenkins),  We should create a build job as well as configuration update job. This seperate configuration update job on build tool would be useful when we need to update only the configurations in the container and no application deployment need to be done. Build job will do the application build, scan and packaging and upload the docker image to the image repository. 

The below given diagram states the full build/deployment flow on DEV environment. Please note that config update on container DEV environment can be done manually as well

Use commands similar to below given to copy files to pods from local
*kubectl cp /tmp/samplefile.txt <container-namespace>/<pod-id>:/tmp/*

image::/img/blog/dev-cluster1.png[Configuration management and deployment on DEV environment ,width=70%,align="center"]

=== 2. QA environment

On QA environment, it's not mandatory to do the code build again. For application deployment, QA team can setup the deployment config in the QA container prior and initiate the redeployment of the image from the build tool. In case of a new image deployment, QA team can update the new image details in container deployment config manually or programmatically from the build job  

To update any configurations from DEV branch to QA branch, DEV team can initiate a pull request and on approval from QA team, it can be merged to QA branch. QA team can directly update any QA environment specific configurations to the configs on QA branch 

image::/img/blog/qa-cluster1.png[Configuration management and deployment on QA environment ,width=70%,align="center"]

=== 3. PROD environment

on PROD environment, deployment pattern is same as on QA environment, PROD team can setup the deployment config in the PROD container prior and initiate the redeployment of the image from the build tool or manually. In case of a new image deployment, PROD team can update the new image details in container deployment config manually or programmatically from the build job 

To update any configurations from QA branch to PROD branch, QA team can initiate a pull request and on approval from PROD team, it can be merged to PROD branch. PROD team can directly update any production environment specific configurations to the configs on PROD branch 

image::/img/blog/prod-cluster1.png[Configuration management and deployment on production environment ,width=70%,align="center"]

== Conclusion

Configurations update through volumes can be done using manual shell script executions from container terminal. Many teams do the code build and packaging for QA and PROD deployment as well, like wise there would be alternatives for every methods explained in this blog. This blogs is an opinionated one, please approach it accordingly .