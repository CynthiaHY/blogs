---
layout: post
title: "Separate stack trace from messages in logged exceptions, time-based log rollover and more exciting new features in Open Liberty 22.0.0.8"
# Do NOT change the categories section
categories: blog
author_picture: https://avatars3.githubusercontent.com/ryan-storey
author_github: https://github.com/ryan-storey
seo-title: Separate stack trace from messages in logged exceptions, time-based log rollover and more exciting new features in Open Liberty 22.0.0.8 - OpenLiberty.io
seo-description: Open Liberty 22.0.0.8 offers several exciting new features, such as separating stack trace from messages in logged exceptions by offering new fields for Open Liberty JSON logging and for the Logstash Collector feature. This enables easier-to-read visualizations in downstream log analysis tools. This release also includes an important security vulnerability (CVE) fix, as well as many notable bug fixes.
blog_description: Open Liberty 22.0.0.8 offers several exciting new features, such as separating stack trace from messages in logged exceptions by offering new fields for Open Liberty JSON logging and for the Logstash Collector feature. This enables easier-to-read visualizations in downstream log analysis tools. This release also includes an important security vulnerability (CVE) fix, as well as many notable bug fixes.
open-graph-image: https://openliberty.io/img/twitter_card.jpg
---
= Separate stack trace from messages in logged exceptions, time-based log rollover and more exciting new features in Open Liberty 22.0.0.8
Ryan Storey <https://github.com/ryan-storey>
:imagesdir: /
:url-prefix:
:url-about: /
//Blank line here is necessary before starting the body of the post.

Open Liberty 22.0.0.8 offers several exciting new features, such as separating stack trace from messages in logged exceptions by offering new fields for Open Liberty JSON logging and for the Logstash Collector feature. This enables easier-to-read visualizations in downstream log analysis tools. This release also includes an important security vulnerability (CVE) fix, as well as many notable bug fixes.

In link:{url-about}[Open Liberty] 22.0.0.8:

* <<stack_trace, Stack trace separated from logged messages in logging records>>
* <<log_rollover, Time-based log rollover for Liberty>>
* <<jaxws, jaxws-2.2 updates to CXF 3.4>>
* <<CVEs, Security Vulnerability (CVE) Fixes>>
* <<bugs, Notable bug fixes>>

View the list of fixed bugs in link:https://github.com/OpenLiberty/open-liberty/issues?q=label%3Arelease%3A22008+label%3A%22release+bug%22[22.0.0.8].

[#run]
== Run your apps using 22.0.0.8

If you're using link:{url-prefix}/guides/maven-intro.html[Maven], here are the coordinates:

[source,xml]
----
<dependency>
    <groupId>io.openliberty</groupId>
    <artifactId>openliberty-runtime</artifactId>
    <version>22.0.0.8</version>
    <type>zip</type>
</dependency>
----

Or for link:{url-prefix}/guides/gradle-intro.html[Gradle]:

[source,gradle]
----
dependencies {
    libertyRuntime group: 'io.openliberty', name: 'openliberty-runtime', version: '[22.0.0.8,)'
}
----

Or if you're using Docker:

[source]
----
FROM open-liberty
----

Or take a look at our link:{url-prefix}/downloads/[Downloads page].

[link=https://stackoverflow.com/tags/open-liberty]
image::img/blog/blog_btn_stack.svg[Ask a question on Stack Overflow, align="center"]

[#stack_trace]
=== Stack trace separated from logged messages in logging records

The stack trace is now separated from logged messages in logging records so that log analysis tools can present them more clearly. This makes visualizations of the logs by downstream log analysis tools easier to read when you are identifying any issues encountered by the application. Previously, any logging record originating from a Java Logger object that made use of any of the methods that accept a `Throwable` parameter would simply append the stack trace to the existing `message` field. Keeping the `message` field solely for the logged message and having a separate field for the stack trace and exception type enhances the effectiveness of log analysis tools down stream.

Java's link:https://docs.oracle.com/javase/8/docs/api/java/util/logging/package-summary.html[Logging API] provides methods that allow you to include a `Throwable` as a parameter. When the `Throwable` object is used, Open Liberty's JSON logging provides two new fields, `ibm_stackTrace` and `ibm_exceptionName`, and the Open Liberty link:{url-prefix}/docs/latest/reference/feature/logstashCollector-1.0.html[Logstash Collector] feature provides two new fields, `stackTrace` and `exceptionName`. The stack trace fields present only the stack trace of the `Throwable` object. The exception name fields present the type of exception of the `Throwable` object.

*Example:*

For the example we will only be showing the message log record for Open Liberty's JSON logging.

Application with the following code snippet:
[source, java]
----
Logger logger = Logger.getLogger(MyResource.class.getCanonicalName());
Exception exception = new IllegalArgumentException("ouch");
logger.log(Level.INFO, "exception message", exception);
----

Previous Open Liberty JSON logging output:

[source, json]
----
{
    "type": "liberty_message",
    ...
    "message": “exception message  java.lang.RuntimeException: ouch\r\n\tatmy.package.MyResource.get(MyResource.java:32)\r\n\tatmy.package.MyResource.get(MyResource.java:20)\r\n...",
    ...
}
----

New Open Liberty JSON logging output:

[source, json]
----
{
    "type": "liberty_message",
    ...
    "message": “exception message",
    "ibm_exceptionName":"java.lang.IllegalArgumentException",
    "ibm_stackTrace":"java.lang.IllegalArgumentException: ouch\r\n\tat my.package.MyResource.get(MyResource.java:20)\r\n...",
    ...
}
----

[#log_rollover]
== Time-based log rollover for Liberty

Liberty provides a few different log files; a `message.log` is created by default, and a `trace.log` and `http_access.log` can be enabled for tracing and `NCSA` access logs respectively. Previously, these log files could be rolled over only by either server restart or by limiting the maximum log file size with the `maxFileSize` logging attribute. Instead of file size-based log rollover, users may want to roll over their files at periodic times to facilitate their existing log cleaning or archival processes. 

Now, you can enable time-based periodic rollover of those log files at their own specified time of day by using two new optional logging configuration attributes: `rolloverInterval` and `rolloverStartTime`. Upon roll over, the file names are appended with a timestamp that corresponds to the time that the log was rolled over.

* `rolloverInterval` is the desired time interval between log rollovers. Set the attribute with a positive integer followed by a unit of time, which can be days (d), hours (h), or minutes (m). For example, specify 5 hours as `5h``. You can include multiple values in a single entry. For example, `1d5h`` is equivalent to 1 day and 5 hours.

* `rolloverStartTime` is the time of day when logs first roll over and the first rollover interval duration begins. Valid values for this attribute follow a 24-hour ISO-8601 time format of HH:MM, where 00:00 represents midnight. 

The two configuration attributes are optional. If neither of the attributes are set, then time-based log rollover is not enabled. If only one of the two attributes is set, then time-based log rollover is enabled, and the other attribute is set to its default. The default value for `rolloverInterval` is `1d`, and the default value for `rolloverStartTime` is `00:00`.

Example `server.xml` file configuration for log rollover in the `messages.log` and `trace.log` files by specifying the new attributes in the `logging` element:

[source, xml]
----
<server>
   ...
    <logging rolloverStartTime="00:00" rolloverInterval="1d"/>
    ...
</server>
----

Example `server.xml` file configuration for log rollover in the `http_access.log` file by specifying the new attributes in the `httpAccessLogging` element:

[source, xml]
----
<server>
   ...
    <httpAccessLogging rolloverStartTime="00:00" rolloverInterval="1d" logFormat='%h %u %{t}W "%r" %s %b' />
    ...
</server>
----

Example `server.xml` configuration for access logging, using `<accessLogging/>` under `<httpEndpoint/>`, which handles `http_access.log` rollover:

[source, xml]
----
<server>
   ...
   <httpEndpoint id="defaultHttpEndpoint">
      <accessLogging rolloverStartTime="00:00" rolloverInterval="1d" logFormat='%h %i %u %t "%r" %s %b' />
   </httpEndpoint>
    ...
</server>
----

Example result of logs, rolled over every minute, with a configuration of `rolloverInterval="1m"` and `rolloverStartTime="00:00"`:

image::/img/blog/log_rollover.png[Example logs,width=70%,align="left"]

For more information about this feature, refer to the link:{url-prefix}/docs/latest/reference/config/httpAccessLogging.html[HTTP Access Logging], link:{url-prefix}/docs/latest/reference/config/logging.html[Liberty Logging], and link:{url-prefix}/docs/latest/access-logging.html[Liberty Access Logging] documentation.

[#jaxws]
== jaxws-2.2 updates to CXF 3.4

We've updated `jaxws-2.2` to use CXF 3.4, which is a huge update coming all way up from CXF 2.6.2. Anyone using `jaxws-2.2` will automatically get the update with 22.0.0.8, and you shouldn't see any behavioral changes with this update. On our end, it does make it much easier to keep `jaxws-2.2` up-to-date going forward, and you will see a much quicker turn around time on pulling in the latest fixes from CXF and it's related dependencies going forward!

[#CVEs]
== Security vulnerability (CVE) fixes in this release
[cols="5*"]
|===
|CVE |CVSS Score |Vulnerability Assessment |Versions Affected |Notes

|link:https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-22476[CVE-2022-22476]
|5
|Identity spoofing
|17.0.0.3 - 22.0.0.7
|Affects the link:{url-prefix}/docs/latest/reference/feature/appSecurity-1.0.html[App Security 1.0], link:{url-prefix}/docs/latest/reference/feature/appSecurity-2.0.html[App Security 2.0], link:{url-prefix}/docs/latest/reference/feature/appSecurity-3.0.html[App Security 3.0] and link:{url-prefix}/docs/latest/reference/feature/appSecurity-4.0.html[App Security 4.0] features
|===

For a list of past security vulnerability fixes, reference the link:{url-prefix}/docs/latest/security-vulnerabilities.html[Security vulnerability (CVE) list].


[#bugs]
== Notable bugs fixed in this release

We’ve spent some time fixing bugs. The following sections describe just some of the issues resolved in this release. If you’re interested, here’s the  link:https://github.com/OpenLiberty/open-liberty/issues?q=label%3Arelease%3A22.0.0.8_NO_PERIODS+label%3A%22release+bug%22[full list of bugs fixed in 22.0.0.8].

== Get Open Liberty 22.0.0.8 now

Available through <<run,Maven, Gradle, Docker, and as a downloadable archive>>.
