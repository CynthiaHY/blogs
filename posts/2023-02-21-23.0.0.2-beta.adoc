---
layout: post
title: "Testing database connections and Jakarta Data preview in Open Liberty 23.0.0.2-beta"
# Do NOT change the categories section
categories: blog
author_picture: https://avatars3.githubusercontent.com/mbroz2
author_github: https://github.com/mbroz2
seo-title: Testing database connections and Jakarta Data preview in Open Liberty 23.0.0.2-beta - OpenLiberty.io
seo-description: Open Liberty 23.0.0.2-beta includes several new enhancements and changes for Liberty InstantOn, aimed at simplifying the process for creating checkpoints and restoring them.  Admin Center's Server Config tool receives new capability to test database connections, and a very early preview of Jakarta Data also makes its beta debut in this release.
blog_description: Open Liberty 23.0.0.2-beta includes several new enhancements and changes for Liberty InstantOn, aimed at simplifying the process for creating checkpoints and restoring them.  Admin Center's Server Config tool receives new capability to test database connections, and a very early preview of Jakarta Data also makes its beta debut in this release.
open-graph-image: https://openliberty.io/img/twitter_card.jpg
open-graph-image-alt: Open Liberty Logo
---
= Testing database connections and Jakarta Data preview in Open Liberty 23.0.0.2-beta
Michal Broz <https://github.com/mbroz2>
:imagesdir: /
:url-prefix:
:url-about: /
//Blank line here is necessary before starting the body of the post.

// // // // // // // //
// In the preceding section:
// Do not insert any blank lines between any of the lines.
// Do not remove or edit the variables on the lines beneath the author name.
//
// "open-graph-image" is set to OL logo. Whenever possible update this to a more appropriate/specific image (For example if present an image that is being used in the post). However, it
// can be left empty which will set it to the default
//
// "open-graph-image-alt" is a description of what is in the image (not a caption). When changing "open-graph-image" to
// a custom picture, you must provide a custom string for "open-graph-image-alt".
//
// Replace TITLE with the blog post title eg: MicroProfile 3.3 is now available on Open Liberty 20.0.0.4
// Replace mbroz2 with your GitHub username eg: lauracowen
// Replace DESCRIPTION with a short summary (~60 words) of the release (a more succinct version of the first paragraph of the post).
// Replace Michal Broz with your name as you'd like it to be displayed, 
// eg: LauraCowen
//
// For every link starting with "https://openliberty.io" in the post make sure to use
// {url-prefix}. e.g- link:{url-prefix}/guides/GUIDENAME[GUIDENAME]:
//
// If adding image into the post add :
// -------------------------
// [.img_border_light]
// image::img/blog/FILE_NAME[IMAGE CAPTION ,width=70%,align="center"]
// -------------------------
// "[.img_border_light]" = This adds a faint grey border around the image to make its edges sharper. Use it around screenshots but not           
// around diagrams. Then double check how it looks.
// There is also a "[.img_border_dark]" class which tends to work best with screenshots that are taken on dark backgrounds.
// Change "FILE_NAME" to the name of the image file. Also make sure to put the image into the right folder which is: img/blog
// change the "IMAGE CAPTION" to a couple words of what the image is
// // // // // // // //

Open Liberty 23.0.0.2-beta includes several new enhancements and changes for Liberty InstantOn, aimed at simplifying the process for creating checkpoints and restoring them.  Admin Center's Server Config tool receives new capability to test database connections, and a very early preview of Jakarta Data also makes its beta debut in this release.  Also included in this beta is all of Jakarta EE Platform 10 and MicroProfile 6.


The link:{url-about}[Open Liberty] 23.0.0.2-beta includes the following beta features (along with link:{url-prefix}/docs/latest/reference/feature/feature-overview.html[all GA features]):

* <<instanton, New enhancements for Liberty InstantOn>>
* <<validation, Testing database connections in Open Liberty apps using Admin Center>>
* <<data, A Very Early Preview of Jakarta Data>>
* <<ee10, Jakarta EE Platform 10 & MicroProfile 10>>

// // // // // // // //
// In the preceding section:
// Change SUB_FEATURE_TITLE to the feature that is included in this release and
// change the SUB_TAG_1/2/3 to the heading tags
//
// However if there's only 1 new feature, delete the previous section and change it to the following sentence:
// "The link:{url-about}[Open Liberty] 23.0.0.2-beta includes SUB_FEATURE_TITLE"
// // // // // // // //

See also link:{url-prefix}/blog/?search=beta&key=tag[previous Open Liberty beta blog posts].

[#instanton]
== New enhancements for Liberty InstantOn
The Open Liberty 22.0.0.11-beta introduced InstantOn, an exciting new feature that provides incredibly fast startup times for MicroProfile and Jakarta EE applications. Since this initial beta release, we've made a few changes and enhancements to make it easier to create and deploy applications with Liberty InstantOn.  They are as follows: 

* Removal of the features checkpoint phase 
* Reduced set of required Linux capabilities to checkpoint and restore
* Simplified container image builds with InstantOn

To learn more about these changes and InstantOn, refer to the link:{url-prefix}/blog/2023/02/10/instant-on-beta-update.html[New enhancements for Liberty InstantOn in 23.0.0.2-beta] blog post.

// // // // DO NOT MODIFY THIS COMMENT BLOCK <GHA-BLOG-TOPIC> // // // // 
// Blog issue: https://github.com/OpenLiberty/open-liberty/issues/23987
// Contact/Reviewer: njr-11,ryan-storey
// // // // // // // // 
[#data]
== A Very Early Preview of Jakarta Data
Jakarta Data is a new Jakarta EE specification that aims to standardize the popular Data Repository pattern across relational and NoSQL databases. As the specification is further developed and Jakarta Data providers become available, it is expected that the Jakarta Data specification will standardize a way to plug in your favorite providers that are currently dominant in the industry, including JNoSQL, to be used in Open Liberty. For now, Open Liberty is making available as beta a test implementation of Jakarta Data that we are using to experiment with proposed specification features so that developers can try out these features and provide feedback to influence the specification as it is being developed. The test implementation currently works with relational databases and operates by redirecting repository operations to the built-in Jakarta Persistence provider. It simulates the entirety of the Jakarta Data beta release, plus some additional proposed features that are being considered.

To use Jakarta Data, start by defining an entity class that corresponds to your data. With relational databases, the entity class corresponds to a database table and the entity properties (public methods and fields of the entity class) generally correspond to the columns of the table. An entity class can be:

- annotated with `jakarta.persistence.Entity` and related annotations from Jakarta Persistence
- a Java class without entity annotations, in which case the primary key is inferred from an entity property named `id` or ending with `Id`.

Next, define one or more repository interfaces for an entity, annotate those interfaces as `@Repository` and inject them into components via CDI. The Jakarta Data provider supplies the implementation of the repository interface for you.

Here's a simple entity, repository, and usage of it.

[source, java]
----
public class Product { // entity
    public long id;
    public String name;
    public float price;
}

@Repository
public interface Products {
    Product findById(long productId);

    @OrderBy("price")
    List<Product> findByNameContains(String searchFor);

    @Query("UPDATE Product o SET o.price = o.price - (?2 * o.price) WHERE o.id = ?1")
    boolean discount(long productId, float discountRate);

    void save(Product p);
}

public class MyServlet extends HttpServlet {
    @Inject
    Products products;

    protected void doGet(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {
        List<Product> found = products.findByNameContains(searchFor);
        ...
    }
}
----

Refer to a link:https://github.com/jakartaee/data/blob/main/spec/src/main/asciidoc/repository.asciidoc[draft of the Jakarta Data specification] and the link:https://search.maven.org/remotecontent?filepath=jakarta/data/jakarta-data-api/1.0.0-b1/jakarta-data-api-1.0.0-b1-javadoc.jar[jakarta.data.repository.Repository JavaDoc] for instructions on how to properly form repository methods so that the Jakarta Data provider understands them.

Optionally, a repository interface can inherit from built-in interfaces such as `jakarta.data.repository.CrudRepository` that define commonly used methods like `findById` and `save` for you,

[source, java]
----
@Repository
public interface Products extends CrudRepository<Product, Long> {
    @OrderBy("price")
    List<Product> findByNameContains(String searchFor);

    @Query("UPDATE Product o SET o.price = o.price - (?2 * o.price) WHERE o.id = ?1")
    boolean discount(long productId, float discountRate);
}
----

Jakarta Data has not yet defined a standard configuration model. For now, the Open Liberty beta reuses the existing `defaultDatabaseStore` configuration (which defaults to the `DefaultDataSource` data source) for Jakarta Data. This means the beta of Jakarta Data is currently limited to a single data source. This of course will change as the specification defines more of a configuration model. The `data-1.0` Liberty beta feature makes the Jakarta Data API available, and you also need a feature for Jakarta Persistence or JDBC (or at some point in the future, Jakarta NoSQL).

Example `server.xml` configuration:

[source, xml]
----
<server>
  <featureManager>
    <feature>data-1.0</feature>
    <feature>persistence-3.1</feature> <!-- could use jdbc-4.3 instead -->
    <feature>servlet-6.0</feature> <!-- the example includes a servlet -->
  </featureManager>

  <dataSource id="DefaultDataSource">
    <jdbcDriver libraryRef="PostgreSQL"/>
    <properties.postgresql databaseName="testdb" serverName="localhost" portNumber="5432"/>
    <containerAuthData user="dbuser1" password="dbpwd1"/>
  </dataSource>

  <library id="PostgreSQL">
    <file name="${shared.resource.dir}/jdbc/postgresql.jar"/>
  </library>

  <!-- optional because the following are all defaulted: -->
  <databaseStore id="defaultDatabaseStore" createTables="true" dropTables="false"
          tablePrefix="WLP" dataSourceRef="DefaultDataSource"/>
</server>
----

You can find the initial 1.0.0-b1 beta release of Jakarta Data on link:https://search.maven.org/artifact/jakarta.data/jakarta-data-api/1.0.0-b1/jar[Maven], which corresponds to the Open Liberty 23.0.0.2-beta.

[source, xml]
----
<dependency>
  <groupId>jakarta.data</groupId>
  <artifactId>jakarta-data-api</artifactId>
  <version>1.0.0-b1</version>
</dependency>
----

### Experimental Function in the Beta of Jakarta Data

This beta provides some additional function that is under consideration for Jakarta Data, but not in the Jakarta Data 1.0.0-b1 beta.

When a global transaction is active on the thread on which a repository operation executes, the repository operation enlists as part of the transaction if the data source that backs the repository is capable of enlistment. Transaction enlistment is default for relational databases, but can be switched off by configuring the data source configuration attribute `transactional` to `false`.

You can use the `@Asynchronous` annotation from Jakarta Concurrency on repository methods to enable them to run asynchronously. This requires the `concurrent-3.0` feature.

[source, java]
----
@Repository
public interface Products extends CrudRepository<Product, Long> {
    @Asynchronous
    @OrderBy("price")
    CompletableFuture<List<Product>> findByNameContains(String searchFor);

    @Asynchronous
    @Query("UPDATE Product o SET o.price = o.price - (?2 * o.price) WHERE o.id = ?1")
    CompletionStage<Boolean> discount(long productId, float discountRate);
}
----

You can also try out the ability to define queries annotatively,

[source, java]
----
@Repository
public interface Products extends CrudRepository<Product, Long> {
    @Filter(by = "name", op = Compare.Contains)
    @Filter(by = "price", op = Compare.LessThanEqual)
    @OrderBy("price")
    List<Product> searchFor(String nameMatch, float maxPrice);

    @Filter(by = "id")
    @Update(attr = "price", op = Operation.Multiply)
    boolean adjustPrice(long productId, float ratio);

    @Delete
    @Filter(by = "name", ignoreCase = true)
    void discontinue(String productName);
}
----

Your feedback is welcome on all of the Jakarta Data features and will be helpful as the specification develops further. Let us know what you think and/or be involved directly in the specification on link:https://github.com/jakartaee/data[github].

    
// DO NOT MODIFY THIS LINE. </GHA-BLOG-TOPIC> 

// // // // DO NOT MODIFY THIS COMMENT BLOCK <GHA-BLOG-TOPIC> // // // // 
// Blog issue: https://github.com/OpenLiberty/open-liberty/issues/23629
// Contact/Reviewer: ReeceNana,k8vance88
// // // // // // // // 
[#validation]
== Testing database connections in Open Liberty apps using Admin Center   
Looking for a simple way to test your database connections? With this beta release, you can now validate your connections using the Liberty Admin Center feature. The test connection will exercise the same code paths as your applications, giving you confidence in your server configuration. The Admin Center connection validation feature is enabled by REST APIs featured in the link:{url-prefix}/blog/2019/09/13/testing-database-connections-REST-APIs.html[Testing database connections in Open Liberty apps with REST APIs] blog post.

To enable database connection testing, the following features must be present in your server's configuration:
[source, xml]
----
    <feature>adminCenter-1.0</feature>
    <feature>appSecurity-2.0</feature>
    <feature>restConnector-2.0</feature>
    <feature>mpOpenApi-1.0</feature>
----

To provide an example, we'll start by testing the server resource `DefaultDataSource` which is configured to connect to a Derby database using container authentication via an auth alias.

Sample server.xml:
[source, xml]
----
<server description="new server">

    <!-- Enable features -->
    <featureManager>
        <feature>adminCenter-1.0</feature>
        <feature>appSecurity-2.0</feature>
        <feature>restConnector-2.0</feature>
        <feature>jdbc-4.3</feature>
        <feature>mpOpenApi-1.0</feature>
    </featureManager>

    <!-- To access this server from a remote client add a host attribute to the following element, e.g. host="*" -->
    <httpEndpoint id="defaultHttpEndpoint" httpPort="9080" httpsPort="9443"/>

    <library id="derby">
      <file name="${server.config.dir}/derby/derby.jar"/>
    </library>

    <dataSource id="DefaultDataSource">
      <jdbcDriver libraryRef="derby"/>
      <!-- Example properties referencing an in-memory Derby Embedded database -->
      <properties.derby.embedded databaseName="memory:defaultdb" createDatabase="create"/>
    </dataSource>

    <authData id="myAuth" user="dbuser" password="dbpass"/>

    <!-- Default SSL configuration enables trust for default certificates from the Java runtime --> 
    <ssl id="defaultSSLConfig" trustDefaultCerts="true"/>

    <remoteFileAccess>
       <writeDir>${server.config.dir}</writeDir>
    </remoteFileAccess>

    <basicRegistry id="basic">
       <user name="admin" password="adminpwd"/>
    </basicRegistry>

    <!-- Assign 'admin' to Administrator -->
    <administrator-role>
        <user>admin</user>
    </administrator-role>

</server>
----

For this `server.xml` example, you will need to add the derby jar to the server configuration or use your own database configuration.

Configure a Liberty server using the above `server.xml` for guidance and then start the server. Once started, you can check the logs to find the URL to navigate to the Admin Center. In the above example, you would navigate to the Admin Center using https://localhost:9443/adminCenter/ URL.

Select "Server Config" tool:
image::img/blog/ac_db_test_server_config.png[Server Config Tool]

Select "server.xml" to edit.
image::img/blog/ac_db_test_serverxml.png[server.xml]

Navigate to the resource you would like to test and click the "Test" button.
image::img/blog/ac_db_test_resource[Select resource]

Choose which type of authentication your application uses:

* For applications that use container authentication: 
+
For this example, the config doesn't have default authentication specified on the datasource element nor are there any login modules configured, therefore you will need to specify an authentication alias by using the dropdown.
+
image::img/blog/ac_db_test_container_auth.png[Container authentication]


* For applications that use application authentication, choose the "Application authentication" tab and fill in a valid user name and password for the database resource.
+
image::img/blog/ac_db_test_app_auth.png[Application authentication]

* If your application does not use a resource reference and you have not `enableContainerAuthForDirectLookups="true"` in the config element, then choose "No resource reference" tab and fill in a valid user name and password for the database resource.
+
image::img/blog/ac_db_test_no_resource_ref.png[No Resource Reference]

Click the 'Connection Test' button and results will be displayed at the bottom.  A successful Connection Test will look like this:
image::img/blog/ac_db_test_successful_test.png[Successful connection test]

In addition to link:{url-prefix}/docs/latest/reference/feature/jdbc-4.3.html[Java Database Connectivity] you can also test connections to link:{url-prefix}/docs/latest/reference/feature/connectors-2.0.html[Jakarta Connectors], link:{url-prefix}/docs/latest/reference/feature/messaging-3.0.html[Jakarta Messaging] and link:{url-prefix}/docs/latest/reference/feature/cloudant-1.0.html[Cloudant Integration] resources. 

// DO NOT MODIFY THIS LINE. </GHA-BLOG-TOPIC> 

[#ee10]
== Jakarta EE 10 & MicroProfile 10
This beta release also includes Jakarta EE Platform 10 and MicroProfile 6 which were first made available in the 22.0.0.13-beta. To find out more, reference the link:{url-prefix}/blog/2022/12/06/22.0.0.13-beta.html[22.0.0.13-beta blog post].


[#run]
=== Try it now 

To try out these features, update your build tools to pull the Open Liberty All Beta Features package instead of the main release. The beta works with Java SE 19, Java SE 17, Java SE 11, and Java SE 8.

If you're using link:{url-prefix}/guides/maven-intro.html[Maven], you can install the All Beta Features package using:

[source,xml]
----
<plugin>
    <groupId>io.openliberty.tools</groupId>
    <artifactId>liberty-maven-plugin</artifactId>
    <version>RELEASE</version>
    <configuration>
        <runtimeArtifact>
          <groupId>io.openliberty.beta</groupId>
          <artifactId>openliberty-runtime</artifactId>
          <version>23.0.0.2-beta</version>
          <type>zip</type>
        </runtimeArtifact>
    </configuration>
</plugin>
----

You must also add dependencies to your pom.xml file for the beta version of the APIs that are associated with the beta features that you want to try.  For example, for Jakarta EE 10 and MicroProfile 6, you would include:
[source,xml]
----
<dependency>
    <groupId>org.eclipse.microprofile</groupId>
    <artifactId>microprofile</artifactId>
    <version>6.0-RC3</version>
    <type>pom</type>
    <scope>provided</scope>
</dependency>
<dependency>
    <groupId>jakarta.platform</groupId>
    <artifactId>jakarta.jakartaee-api</artifactId>
    <version>10.0.0</version>
    <scope>provided</scope>
</dependency>
----

Or for link:{url-prefix}/guides/gradle-intro.html[Gradle]:

[source,gradle]
----
dependencies {
    libertyRuntime group: 'io.openliberty.beta', name: 'openliberty-runtime', version: '[23.0.0.2-beta,)'
}
----

Or take a look at our link:{url-prefix}/downloads/#runtime_betas[Downloads page].

For more information on using a beta release, refer to the link:{url-prefix}docs/latest/installing-open-liberty-betas.html[Installing Open Liberty beta releases] documentation.

[#feedback]
== We welcome your feedback

Let us know what you think on link:https://groups.io/g/openliberty[our mailing list]. If you hit a problem, link:https://stackoverflow.com/questions/tagged/open-liberty[post a question on StackOverflow]. If you hit a bug, link:https://github.com/OpenLiberty/open-liberty/issues[please raise an issue].


