---
layout: post
title: "Using the Eclipse Transformer for Jakarta EE 9 Development and Test"
categories: blog
author_picture: TBD
author_github: https://github.com/tbitonti
seo-title: Using the Eclipse Transformer for Jakarta EE 9 Development and Test
seo-description: The Eclipse Transformer, an Eclipse hosted open source project, provides a tool which can be used to quickly create Jakarta EE 9 enabled artifacts from existing Java / Jakarta EE artifacts.  Artifacts which can be transformed include applications in source and binary form, test code, and Open Liberty server configurations.  This article provides a brief introduction to the Eclipse Transformer and shows how to use the Eclipse Transformer command line interface.
blog_description: "The Eclipse Transformer, an Eclipse hosted open source project, provides a tool which can be used to quickly create Jakarta EE 9 enabled artifacts from existing Java / Jakarta EE artifacts.  Artifacts which can be transformed include applications in source and binary form, test code, and Open Liberty server configurations.  This article provides a brief introduction to the Eclipse Transformer and shows how to use the Eclipse Transformer command line interface."
open-graph-image: https://openliberty.io/img/twitter_card.jpg
---
= Using the Eclipse Transformer for Jakarta EE 9 Development and Test
Thomas Bitonti <https://github.com/tbitonti>

== Overview

This article describes how application developers can use the Eclipse Transformer to update their application and test artifacts to run using Jakarta EE 9.

The core problem introduced by Jakarta EE 9 is the renaming of package prefixes from "javax" to "jakarta" for APIs and properties.  As a consequence, existing applications which run against Java EE or against Jakarta EE 8 do not run against Jakarta EE 9.  To run existing applications as Jakarta EE 9 applications, references to specific packages must be updated.

To solve this problem, the Open Liberty development team created the Eclipse Transformer.  This open source project provides a utility which updates package references in a variety of artifacts.

The Open Liberty team uses the Eclipse Transformer on existing Java / Jakarta EE implementation archives.  The Open Liberty team also uses the transformer to update test artifacts, which include:

* Test applications;
* The actual tests;
* Server configuration files used by the tests;

In a similar fashion, application developers can use the Eclipse Transformer to transform their applications and test artifacts.

The transformer is quick and efficient.  When integrated as a build step, as is done in Open Liberty builds, use of the transformer avoids the creation of new Jakarta EE 9 source files.

== Transformation Strategy

The stratgy used for Jakarta EE 9 test enablement in Open Liberty is to annotate test classes and methods to indicate which of these are to be run as Jakarta EE 9 tests.  The Open Liberty test framework transforms and re-runs the annotated tests as Jakarta EE 9 tests.

Two types of updates are required when transforming test artifacts.  First, package references must be updated, changing old "javax" package references into new "jakarta" package references.  Package references can be in several locations, including test applications, test code, and server configurations.  Second, server configurations must be updated to replace old Java / Jakarta EE 8 features with corresponding new Jakarta EE 9 features.

Open Liberty updates package references using using the Eclipse Transformer.

Open Liberty updates server configurations using custom java code which is built into the Open Liberty test frameworks.  Application and test developers will need to write similar custom code, or will need to update server configurations manually.  (Server configuration features could be updated using the transformer, if rules data were created with appropriate substitution values.)

== Invoking the Transformer

The Eclipse Transformer can be used directly from the command line, as a build task, or from Java code.  This article describes using the transformer from the command line.

(See the link:https://projects.eclipse.org/projects/technology.transformer[transformer project pages] for detailed usage guidelines.)

=== Downloading the Transformer 

Top level link:https://projects.eclipse.org/projects/technology.transformer/downloads[downloads links] are available within the project pages.

Several current link:https://oss.sonatype.org/content/repositories/snapshots/org/eclipse/transformer/org.eclipse.transformer.cli/[snapshots] are usually available.

=== Building the transformer

Alternatively, the transformer can be built by cloning the link:https://github.com/eclipse/transformer[Eclipse Transformer repository] and invoking maven to build the transformer jar:

[source]
--
    maven clean package
--

=== Preparing a work area

Download or copy the transformer binaries to a local directory:

[source]
--
    mkdir <work>
    cd <work>
    cp transformer/org.eclipse.transformer.cli/target/org.eclipse.transformer.cli-0.3.0-SNAPSHOT-distribution.jar .
    unzip org.eclipse.transformer.cli-0.3.0-SNAPSHOT-distribution.jar
--

Unpackaging the distribution obtains:

[source]
--
    org.eclipse.transformer.cli-0.3.0-SNAPSHOT.jar
    libs/org.eclipse.transformer-0.3.0-SNAPSHOT.jar
    libs/biz.aQute.bnd.transform-5.2.0.jar
    libs/slf4j-api-1.7.25.jar
    libs/commons-cli-1.4.jar
    libs/slf4j-simple-1.7.30.jar
--

=== Running the transformer

The transformer can now be run using the default rules:

[source]
--
  java -jar org.eclipse.transformer.cli-0.3.0-SNAPSHOT.jar \
    <target_location> \
    <output_location>
--

(The jar 'org.eclipse.transformer.cli-0.3.0-SNAPSHOT.jar' is runnable, with the invocation selecting as main class 'org.eclipse.transformer.jakarta.JakartaTransformer' and with the necessary jars from the 'libs' folder included in the class path.)

The transformer can be run using custom rules by specifying additional options on the command line.  The additional options specify local rules files that the transformer uses instead of the default rules files.

For example, to use Open Liberty rules data, which can be more up-to-date than the default rules data, download link:https://github.com/OpenLiberty/open-liberty/tree/integration/dev/wlp-jakartaee-transform/rules[Open Liberty Rules].  Then pull in the downloaded rules data by adding options "-tr", "-td", and "-tf", to the command line invocation:

[source]
--
  java -jar org.eclipse.transformer.cli-0.3.0-SNAPSHOT.jar \
    <target_location> \
    <output_location> \
    -tr ${rules}/jakarta-renames.properties \
    -td ${rules}/jakarta-direct.properties \
    -tf ${rules}/jakarta-xml-master.properties
--

(These three command line options are most important.  While other command line options are available, for example, for transforming bundle archives, and for more finely selecting which target files are to be transformed, those other options are not usually needed.)

The target location can be a packaged application archive (EAR, WAR, RAR, or JAR file) or can be a directory containing the fully or partially expanded contents of one of these archives.  The target can also be a directory containing Java source, or a directory containing several application archives.  All of the artifacts in the target location are processed by the transformer.

=== More about transforming server configurations

Transformation of a server configuration is only necessary when "javax" prefixed package names are exposed in the server configuration.  One case is JMS activation specification elements.  For example:

[source]
--
  <jmsActivationSpec id="SharedSubscriptionWithMsgSel/TestTopic1">
    <properties.wasJms
        destinationRef="jms/FAT_TOPIC"
        destinationType="javax.jms.Topic"
        subscriptionDurability="DurableShared"
        clientId="cid1"
        subscriptionName="DURSUB"/>
  </jmsActivationSpec>
--

This must be transformed to:

[source]
--
  <jmsActivationSpec id="SharedSubscriptionWithMsgSel/TestTopic1">
    <properties.wasJms
        destinationRef="jms/FAT_TOPIC"
        destinationType="jakarta.jms.Topic"
        subscriptionDurability="DurableShared"
        clientId="cid1"
        subscriptionName="DURSUB"/>
  </jmsActivationSpec>
--

== Updating features in server configurations

When running a Jakarta EE 9 enabled application using Open Liberty, Jakarta EE 9 features must be specified in the server configuration.  In many cases, Jakarta EE 9 features use the same short names as the corresponding Java / Jakarta EE features.  The Jakarta EE 9 features simply update the feature version.  In other cases, both the feature short name and the feature version must be updated.

When both the feature short name and the feature name must be updated, if the old short name is used with the new Jakarta EE 9 version, the server will not start, and the server logs will provide information to say which new feature short name must be used.  For example, if "ejb-3.2" were incorrectly changed to "ejb-4.0", the server logs would indicate that "enterpriseBeans-4.0" must be used.

Here is a table of features which use the same short names and for which only the feature version is updated:

.Java / Jakarta EE to Jakarta EE 9 Feature Updates: Version Only
|===
| Java / Jakarta EE feature name | Jakarta EE 9 feature name

| appClientSupport-1.0
| appClientSupport-2.0

| appSecurity-3.0
| appSecurity-4.0

| batch-1.0
| batch-2.0

| beanValidation-2.0
| beanValidation-3.0

| cdi-2.0
| cdi-3.0

| concurrent-1.0
| concurrent-2.0

| jsonb-1.0
| jsonb-2.0

| jsonbContainer-1.0
| jsonbContainer-2.0

| jsonp-1.1
| jsonp-2.0

| jsonpContainer-1.1
| jsonpContainer-2.0

| managedBeans-1.0
| managedBeans-2.0

| mdb-3.2
| mdb-4.0

| servlet-4.0
| servlet-5.0

| webProfile-8.0
| webProfile-9.0

| websocket-1.1
| websocket-2.0
|===

Here is a table of features which update both the feature short name and the feature version.

.Java / Jakarta EE to Jakarta EE 9 Feature Updates: Short Name and Version
|===
| Java / Jakarta EE feature name | Jakarta EE 9 feature name

| javaee-8.0
| jakartaee-9.0

| javaeeClient-8.0
| jakartaeeClient-9.0

| ejb-3.2
| enterpriseBeans-4.0

| ejbHome-3.2
| enterpriseBeansHome-4.0

| ejbLite-3.2
| enterpriseBeansLite-4.0

| ejbPersistentTimer-3.2
| enterpriseBeansPersistentTimer-4.0

| ejbRemote-3.2
| enterpriseBeansRemote-4.0

| el-3.0
| expressionLanguage-4.0

| jacc-1.5
| appAuthorization-2.0

| jaspic-1.1
| appAuthentication-2.0

| javaMail-1.6
| mail-2.0

| jaxb-2.2
| xmlBinding-3.0

| jaxrs-2.1
| restfulWS-3.0

| jaxrsClient-2.1
| restfulWSClient-3.0

| jaxws-2.2
| xmlWS-3.0

| jca-1.7
| connectors-2.0

| jcaInboundSecurity-1.0
| connectorsInboundSecurity-2.0

| jms-2.0
| messaging-3.0

| jpa-2.2
| persistence-3.0

| jpaContainer-2.2
| persistenceContainer-3.0

| jsf-2.3
| faces-3.0

| jsfContainer-2.3
| facesContainer-3.0

| jsp-2.3
| pages-3.0

| wasJmsClient-2.0
| messagingClient-3.0

| wasJmsSecurity-1.0
| messagingSecurity-3.0

| wasJmsServer-1.0
| messagingServer-3.0
|===

== Reference resources

=== Eclipse Transformer project links

The link:https://projects.eclipse.org/projects/technology.transformer[Main Eclipse Transformer] page.

The transformer GIT repository: link:https://github.com/OpenLiberty/open-liberty/tree/integration/dev/wlp-jakartaee-transform[dev/wlp-jakartaee-transform].

Top level link:https://projects.eclipse.org/projects/technology.transformer/downloads[downloads links].

Several current transformer link:https://oss.sonatype.org/content/repositories/snapshots/org/eclipse/transformer/org.eclipse.transformer.cli/[snapshots].

=== Open Liberty project links

Open Liberty transformer data: link:https://github.com/OpenLiberty/open-liberty/tree/integration/dev/wlp-jakartaee-transform/rules[dev/wlp-jakartaee-transform/rules].

Open Liberty gradle tasks used to transform bundle implementation jars: link:https://github.com/OpenLiberty/open-liberty/blob/integration/dev/wlp-gradle/subprojects/tasks.gradle[dev/wlp-gradle/subprojects/tasks.gradle].

Open Liberty gradle tasks used to transform FAT (Feature Acceptance Test) artifacts: link:https://github.com/OpenLiberty/open-liberty/blob/integration/dev/wlp-gradle/subprojects/fat.gradle[dev/wlp-gradle/subprojects/fat.gradle].

Open Liberty Java transformer invocation used on FAT (Feature Acceptance Test) application archives: link:https://github.com/OpenLiberty/open-liberty/blob/integration/dev/fattest.simplicity/src/componenttest/rules/repeater/JakartaEE9Action.java#L204[JakartaEE9Action.transformApp].

Java source for the the custom Open Liberty "repeat test action": link:https://github.com/OpenLiberty/open-liberty/blob/integration/dev/fattest.simplicity/src/componenttest/rules/repeater/JakartaEE9Action.java[dev/fattest.simplicity/src/componenttest/rules/repeater/JakartaEE9Action.java].
