---
layout: post
title: "TITLE"
# Do NOT change the categories section
categories: blog
author_picture: https://avatars3.githubusercontent.com/ryan-storey
author_github: https://github.com/ryan-storey
seo-title: MicroProfile updates and enhancements to JPA persistence properties in Open Liberty 22.0.0.1-beta - OpenLiberty.io
seo-description: Open Liberty 22.0.0.1-beta offers new MicroProfile updates, with MicroProfile 5.0, MicroProfile Open Tracing 3.0 and Rest Client 3.0, which aligns with Jakarta EE 9.1. Also in this release is an enhancement to JPA persistence properties at a server scope. 
blog_description: Open Liberty 22.0.0.1-beta offers new MicroProfile updates, with MicroProfile 5.0, MicroProfile Open Tracing 3.0 and Rest Client 3.0, which aligns with Jakarta EE 9.1. Also in this release is an enhancement to JPA persistence properties at a server scope. 
open-graph-image: https://openliberty.io/img/twitter_card.jpg
---
= MicroProfile updates and enhancements to JPA persistence properties in Open Liberty 22.0.0.1-beta
Ryan Storey <https://github.com/ryan-storey>
:imagesdir: /
:url-prefix:
:url-about: /
//Blank line here is necessary before starting the body of the post.

Open Liberty 22.0.0.1-beta offers new MicroProfile updates, with MicroProfile 5.0, MicroProfile Open Tracing 3.0 and Rest Client 3.0, which aligns with Jakarta EE 9.1. Also in this release is an enhancement to JPA persistence properties at a server scope. 

We have two beta packages for link:{url-about}[Open Liberty]:

* <<allbeta, All Beta Features>>: a larger package that contains all Open Liberty beta features (including Jakarta EE 9 beta features) and GA features and functions.
* <<jakarta, Jakarta EE 9 Beta Features>>: a lightweight package that contains only the Jakarta EE 9 features.

This means that you can now try out our in-development Open Liberty features by just adding the relevant coordinates to your build tools.

If you try either package, <<feedback, let us know what you think>>.

[#allbeta]
== All Beta Features package

The All Beta Features package includes the following beta features:

* <<opentracing, MicroProfile OpenTracing 3.0>>
* <<jpa_persistence, Define JPA persistence properties at server scope>>
* <<rest_client, MicroProfile Rest Client 3.0>>
* <<mp_5.0, MicroProfile 5.0>>

[#opentracing]
=== MicroProfile OpenTracing 3.0

This feature `mpOpenTracing-3.0` is the implementation of the Eclipse MicroProfile OpenTracing 3.0 release, which aligns with Jakarta EE 9.1. This feature replaces the Javax namespace with Jakarta in order for it to be used for Jakarta EE 9.1 applications. There is no other functional changes introduced in this feature.

Prior releases of OpenTracing were for the Java EE platform but with this release, you can use MicroProfile OpenTracing with Jakarta EE 9.1.

You can enable the MicroProfile OpenTracing 3.0 feature by using the mpOpenTracing-3.0 feature in the server.xml file:

[source, xml]
----
<featureManager>              
    <feature>mpOpenTracing-3.0</feature>
</featureManager>
----

To find out more, check out the link:https://github.com/eclipse/microprofile-opentracing[Eclipse MicroProfile OpenTracing Project] page, or the link:https://download.eclipse.org/microprofile/microprofile-opentracing-3.0-RC3/microprofile-opentracing-spec-3.0-RC3.html[MicroProfile OpenTracing-3.0 Specification].

[#jpa_persistence]
=== Define JPA persistence properties at server scope

This new JPA enhancement adds the ability to declare "default" JPA persistence properties, to all container-managed persistence contexts, as a Liberty server.xml configuration.

Previously, if a persistence property needed to be set for all persistence.xml configuration files, you would manually update all persistence.xml files in all applications. This could end up requiring hundreds of manual updates and/or rebuilding of applications.
With this enhancement, you can specify persistence properties, in the server.xml, that will propagate to all container-managed persistence units for applications installed on that server.

In order to start using the new feature, you only need to add the new `<defaultProperties>` configuration to your `<jpa>` configuration, in server.xml, along with the persistence properties that you want to apply to all container-managed persistence units:

*Example 1:*

[source, xml]
----
<server>
    <featureManager>
        <feature>persistenceContainer-3.0</feature>
    </featureManager>

    <jpa defaultPersistenceProvider="org.hibernate.jpa.HibernatePersistenceProvider">
        <defaultProperties>
            <property name="javax.persistence.lock.timeout" value="4000"/>
            <property name="hibernate.dialect" value="org.hibernate.dialect.Oracle12cDialect"/>
        </defaultProperties>
    </jpa>
</server>
----

*Example 2:*

[source, xml]
----
<server>
    <featureManager>
        <feature>jpa-2.1</feature>
    </featureManager>

    <jpa>
        <defaultProperties>
            <property name="javax.persistence.lock.timeout" value="12345"/>
            <property name="eclipselink.cache.shared.default" value="false"/>
        </defaultProperties>
    </jpa>
</server>
----

*Technical description*

These `defaultProperties`, integration-level persistence properties will be supplied to the persistence provider specified when the `PersistenceProvider.createContainerEntityManagerFactory` method is called by the JPA Container.

According to the JPA specification (3.4.4.3):

```
If the same property or hint is specified more than once, the following order of overriding applies, in order of decreasing precedence:
  • argument to method of EntityManager, Query, or TypedQuery interface
  • specification to NamedQuery (annotation or XML)
  • argument to createEntityManagerFactory method
  • specification in persistence.xml
```

This means these new `defaultProperties` persistence property values will override the properties specified in persistence.xml with the same name. However, property values specified through PersistenceContext annotation, or the `persistence-context-ref` deployment descriptor element, or Query Hints property will override these `defaultProperties`.

[#rest_client]
=== MicroProfile Rest Client 3.0

MicroProfile Rest Client is an API intended to enable developers to write type-safe interfaces to abstract and invoke remote RESTful services. This is the 3.0 release of MicroProfile Rest Client, and it adds support for Jakarta EE 9.1 technologies - from a developer's perspective, the only change from the previous release (2.0) is the package space name change of Jakarta packages from `javax.*` to `jakarta.*`. Another change is that the Open Liberty implementation has changed from Apache CXF to RESTEasy - this change brings with it some behavior and property changes (most of which are already documented as differences between `jaxrs-2.1` and `restfulWS-3.0`).  

To use this new feature, you would need to add `mpRestClient-3.0` to the `featureManager` element in the server.xml. The code should be similar to previous versions of MP Rest Client, but the packages should change from `javax.*` to `jakarta.*`.

[source, xml]
----
<featureManager>              
    <feature>mpRestClient-3.0</feature>
</featureManager>
----

For more information, check out:

* link:https://github.com/eclipse/microprofile-rest-client[Eclipse MicroProfile Rest Client GitHub]
* link:http://download.eclipse.org/microprofile/microprofile-rest-client-3.0-RC5/microprofile-rest-client-spec-3.0-RC5.html[MicroProfile Rest Client 3.0 Specification]
* link:http://download.eclipse.org/microprofile/microprofile-rest-client-3.0-RC5/apidocs/[MicroProfile Rest Client 3.0 API Javadoc]

[#mp_5.0]
=== MicroProfile 5.0

MicroProfile 5.0 enables applications to use MicroProfile APIs together with Jakarta EE 9.1. MicroProfile 5.0 does not provide any other functional updates except aligning with Jakarta EE 9.1.  MicroProfile 5.0 includes Config 3.0, Fault Tolerance 4.0, Rest Client 3.0, Health 4.0, Metrics 4.0, Open Tracing 3.0, Open API 3.0, and JWT propagation 2.0. This beta driver will be used as a compatible implementation for releasing MicroProfile 5.0.

Include the following in the `server.xml` to enable the MicroProfile 5.0 feature in Open Liberty:

[source, xml]
----
<featureManager>              
    <feature>microProfile-5.0</feature>
</featureManager>
----

For more information about this update check out the link:https://github.com/eclipse/microprofile/releases/tag/5.0[MicroProfile 5.0 Release] on GitHub.
   
=== Try it now 

To try out these features, just update your build tools to pull the Open Liberty All Beta Features package instead of the main release. The beta works with Java SE 15, Java SE 11, or Java SE 8.

If you're using link:{url-prefix}/guides/maven-intro.html[Maven], here are the coordinates:

[source,xml]
----
<dependency>
  <groupId>io.openliberty.beta</groupId>
  <artifactId>openliberty-runtime</artifactId>
  <version>22.0.0.1-beta</version>
  <type>pom</type>
</dependency>
----

Or for link:{url-prefix}/guides/gradle-intro.html[Gradle]:

[source,gradle]
----
dependencies {
    libertyRuntime group: 'io.openliberty.beta', name: 'openliberty-runtime', version: '[22.0.0.1-beta,)'
}
----

Or take a look at our link:{url-prefix}/downloads/#runtime_betas[Downloads page].

[#jakarta]
== Jakarta EE 9 Beta Features package

Open Liberty is the first vendor product to be Jakarta EE Web Profile 9.0 compatible since the 21.0.0.2-beta release. Open Liberty is also the first vendor product to be added to the link:https://jakarta.ee/compatibility/#tab-9[Jakarta EE Platform 9.0 compatibility list], with the release of 21.0.0.3-beta.  That same beta release was then also used to add Open Liberty to the link:https://jakarta.ee/compatibility/#tab-9_1[Jakarta EE Platform 9.1 compatibility list].
Open Liberty 21.0.0.6-beta further expanded on this compatability by including new Jakarta EE9 supporting features, and 22.0.0.1-beta offers the same compatability with Jakarta EE9 with performance enhancements.

Enable the Jakarta EE 9 beta features in your app's `server.xml`. You can enable the individual features you want or you can just add the Jakarta EE 9 convenience feature to enable all of the Jakarta EE 9 beta features at once:

[source, xml]
----
  <featureManager>
    <feature>jakartaee-9.0</feature>
  </featureManager>
----

Or you can add the Web Profile convenience feature to enable all of the Jakarta EE 9 Web Profile beta features at once:

[source, xml]
----
  <featureManager>
    <feature>webProfile-9.0</feature>
  </featureManager>
----

=== Try it now

To try out these Jakarta EE 9 features on Open Liberty in a lightweight package, just update your build tools to pull the Open Liberty Jakarta EE 9 Beta Features package instead of the main release. The beta works with Java SE 15, Java SE 11, or Java SE 8.

If you're using link:{url-prefix}/guides/maven-intro.html[Maven], here are the coordinates:

[source,xml]
----
<dependency>
    <groupId>io.openliberty.beta</groupId>
    <artifactId>openliberty-jakartaee9</artifactId>
    <version>22.0.0.1-beta</version>
    <type>zip</type>
</dependency>
----

Or for link:{url-prefix}/guides/gradle-intro.html[Gradle]:

[source,gradle]
----
dependencies {
    libertyRuntime group: 'io.openliberty.beta', name: 'openliberty-jakartaee9', version: '[22.0.0.1-beta,)'
}
----

Or take a look at our link:{url-prefix}/downloads/#runtime_betas[Downloads page].

[#feedback]
== Your feedback is welcomed

Let us know what you think on link:https://groups.io/g/openliberty[our mailing list]. If you hit a problem, link:https://stackoverflow.com/questions/tagged/open-liberty[post a question on StackOverflow]. If you hit a bug, link:https://github.com/OpenLiberty/open-liberty/issues[please raise an issue].


